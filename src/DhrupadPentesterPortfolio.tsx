import { useEffect, useRef, useState } from "react";
import { motion } from "framer-motion";

import profilePic from "./1743031208247.jpeg";
import postRouterImg from "./1756618561255.jpeg";
import postIdsImg from "./1748548362883.jpeg";
import postGenAiImg from "./1745196946372.jpeg";
import postCapImg from "./1745196947867.jpeg";
import postMaccdcImg from "./1737680879943.jpeg";

const Section = ({ id, title, subtitle, children }: any) => (
  <section id={id} className="scroll-mt-24 py-16 sm:py-24">
    <div className="max-w-6xl mx-auto px-4">
      <div className="mb-8">
        <h2 className="text-3xl sm:text-4xl font-black tracking-tight text-white/90">
          {title}
        </h2>
        {subtitle && (
          <p className="mt-2 text-white/60 max-w-2xl">{subtitle}</p>
        )}
        <div className="h-0.5 w-24 bg-gradient-to-r from-cyan-400/80 via-fuchsia-400/80 to-indigo-400/80 rounded mt-4" />
      </div>
      {children}
    </div>
  </section>
);

const Chip = ({ children }: any) => (
  <span className="inline-flex items-center rounded-full border border-white/10 bg-white/5 px-3 py-1 text-xs sm:text-sm text-white/80 backdrop-blur hover:bg-white/10 transition">
    {children}
  </span>
);

const Card = ({ children, className = "" }: any) => (
  <div className={`group relative rounded-2xl border border-white/10 bg-gradient-to-b from-white/5 to-white/[0.03] p-5 sm:p-6 shadow-2xl shadow-black/30 hover:shadow-cyan-500/10 hover:border-cyan-400/30 transition ${className}`}>
    <div className="absolute inset-0 rounded-2xl opacity-0 group-hover:opacity-100 transition bg-[radial-gradient(60%_60%_at_50%_0%,rgba(0,255,255,0.08),transparent_70%)]" />
    {children}
  </div>
);

function useTypewriter(lines: string[], speed = 24, gap = 1200) {
  const [text, setText] = useState("");
  const [i, setI] = useState(0);
  const [j, setJ] = useState(0);
  const [deleting, setDeleting] = useState(false);

  useEffect(() => {
    const tick = setTimeout(() => {
      const line = lines[i % lines.length];
      if (!deleting) {
        setText(line.slice(0, j + 1));
        setJ(j + 1);
        if (j + 1 === line.length) setDeleting(true);
      } else {
        if (j === 0) {
          setDeleting(false);
          setI((i + 1) % lines.length);
        } else {
          setText(line.slice(0, j - 1));
          setJ(j - 1);
        }
      }
    }, deleting ? speed / 1.5 : speed);

    const pause = setTimeout(() => {
      if (text.length === lines[i % lines.length].length) setDeleting(true);
    }, gap);

    return () => { clearTimeout(tick); clearTimeout(pause); };
  }, [text, j, i, deleting]);

  return text + "_";
}

export default function DhrupadPentesterPortfolio() {
  const phrases = [
    "→ Pentester. Network Defender. Builder.",
    "→ Breaking things to secure them.",
    "→ DDoS labs, routers, digital twins.",
    "→ Python • Bash • PowerShell • Java • TS",
  ];
  const typed = useTypewriter(phrases, 24, 1200);

  const posts = [
    {
      title: "Turning a Router into a Homelab",
      date: "3d ago",
      excerpt:
        "How I transformed a TP-Link Archer C7 router into a mini homelab using OpenWrt, banIP, AdGuard Home, USB storage, motion detection and Tailscale VPN — proving you don't need expensive gear to learn cybersecurity.",
      image: postRouterImg,
      tags: ["OpenWrt", "banIP", "AdGuard", "Tailscale"],
      link: "https://www.linkedin.com/feed/update/urn:li:activity:7369013832293289984/",
    },
    {
      title: "Intrusion Detection Lab",
      date: "3mo ago",
      excerpt:
        "A lightweight, Docker-powered lab co-built with Rishikesh Galande that gives defenders a no-stress, hands-on experience in intrusion detection and incident response — complete with a live attacker and gamified flag hunt.",
      image: postIdsImg,
      tags: ["Docker", "IDS", "Gamified"],
      link: "https://lnkd.in/gey2aRqc",
    },
    {
      title: "Re-imagining Education with Generative AI",
      date: "4mo ago",
      excerpt:
        "At the ReSENSE Lab I research GenAI-powered learning frameworks that turn large language models into active educational partners, augmenting rather than replacing critical thinking. We presented our progress at a university poster session.",
      image: postGenAiImg,
      tags: ["GenAI", "Education", "Research"],
      link: "https://www.resenselab.org",
    },
    {
      title: "Certified AppSec Practitioner (CAP)",
      date: "6mo ago",
      excerpt:
        "Earned the Certified AppSec Practitioner (CAP) credential from The SecOps Group. Now I'm certified to patch vulnerabilities, secure apps and crack a cybersecurity joke or two.",
      image: postCapImg,
      tags: ["Certification", "AppSec"],
      link: "https://www.thesecopsgroup.com",
    },
    {
      title: "MACCDC Team Heads to Regionals",
      date: "7mo ago",
      excerpt:
        "Proud member of Penn State’s Mid-Atlantic Collegiate Cyber Defense Competition team. We placed 2nd out of 17 teams at qualifiers and advanced to regionals, sharpening blue team skills and team spirit.",
      image: postMaccdcImg,
      tags: ["Competition", "Blue Team"],
      link: "#",
    },
  ];

  const gridRef = useRef(null);

  return (
    <div className="min-h-screen bg-[#06080b] text-white selection:bg-cyan-400/30 selection:text-white">
      <div className="fixed inset-x-0 top-0 h-[2px] bg-gradient-to-r from-cyan-400 via-fuchsia-400 to-indigo-400" />
      <div ref={gridRef} className="pointer-events-none fixed inset-0 opacity-20">
        <svg className="w-full h-full" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
              <path d="M 40 0 L 0 0 0 40" fill="none" stroke="url(#g)" strokeWidth="0.5" />
            </pattern>
            <linearGradient id="g" x1="0" x2="1">
              <stop offset="0%" stopColor="#67e8f9" stopOpacity="0.3" />
              <stop offset="100%" stopColor="#a78bfa" stopOpacity="0.3" />
            </linearGradient>
          </defs>
          <rect width="100%" height="100%" fill="url(#grid)" />
        </svg>
      </div>

      <header className="sticky top-0 backdrop-blur supports-[backdrop-filter]:bg-black/30 z-40 border-b border-white/10">
        <nav className="max-w-6xl mx-auto px-4 flex items-center justify-between h-16">
          <div className="font-black tracking-widest text-white/90">
            <span className="text-cyan-400">[</span>DJ<span className="text-fuchsia-400">]</span>
          </div>
          <div className="hidden sm:flex gap-6 text-white/70 text-sm">
            <a href="#about" className="hover:text-white">About</a>
            <a href="#experience" className="hover:text-white">Experience</a>
            <a href="#projects" className="hover:text-white">Projects</a>
            <a href="#posts" className="hover:text-white">Posts</a>
            <a href="#skills" className="hover:text-white">Skills</a>
            <a href="#contact" className="hover:text-white">Contact</a>
          </div>
          <a
            href="https://www.linkedin.com/in/dhrupad-joshi/"
            target="_blank"
            className="rounded-xl border border-cyan-400/40 bg-cyan-400/10 px-3 py-1.5 text-sm hover:bg-cyan-400/20"
          >
            LinkedIn ↗
          </a>
        </nav>
      </header>

      <div className="relative">
        <div className="max-w-6xl mx-auto px-4 pt-14 sm:pt-24 pb-10 sm:pb-20">
          <motion.div
            initial={{ opacity: 0, y: 10 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.6 }}
            className="grid md:grid-cols-2 gap-8 items-center"
          >
            <div>
              <img
                src={profilePic}
                alt="Profile photo"
                className="rounded-full w-32 h-32 mb-4 border-4 border-cyan-500/60 object-cover shadow-lg"
              />
              <h1 className="text-4xl sm:text-6xl font-black leading-tight">
                Dhrupad <span className="text-white/60 font-extrabold">Joshi</span>
              </h1>
              <p className="mt-3 text-lg sm:text-xl text-white/80">
                Cybersecurity @ Penn State — pentester, builder of DDoS labs & router automations, 
                turning offense into defense.
              </p>
              <p className="mt-4 font-mono text-cyan-300/90">{typed}</p>

              <div className="mt-6 flex flex-wrap gap-3">
                <a href="#projects" className="rounded-xl px-4 py-2 bg-white/10 border border-white/15 hover:bg-white/15">View Projects</a>
                <a href="#contact" className="rounded-xl px-4 py-2 bg-cyan-500/20 border border-cyan-400/40 hover:bg-cyan-500/30">Contact</a>
                <a href="#resume" className="rounded-xl px-4 py-2 bg-fuchsia-500/20 border border-fuchsia-400/40 hover:bg-fuchsia-500/30">Resume</a>
              </div>
            </div>

            <Card>
              <div className="font-mono text-sm">
                <div className="flex items-center gap-2 mb-3">
                  <div className="h-2.5 w-2.5 rounded-full bg-red-400/80" />
                  <div className="h-2.5 w-2.5 rounded-full bg-yellow-400/80" />
                  <div className="h-2.5 w-2.5 rounded-full bg-green-400/80" />
                  <span className="ml-2 text-white/60">/bin/bash — secure@lab</span>
                </div>
                <pre className="whitespace-pre-wrap leading-6">
{`$ whoami
> dhrupad
$ nmap -sC -sV portfolio.local
> 80/tcp open  http  — Vite/React/Tailwind
> 443/tcp open https — Hardened TLS
$ ./attack-sim --module L7 --traffic randomized --mitigate
> ✔ Digital Twin active (Sightline ▸ OPNsense ▸ DIS)
$ echo "Offense informs defense."`}
                </pre>
              </div>
            </Card>
          </motion.div>
        </div>
      </div>

      <Section id="about" title="About" subtitle="Graduate cybersecurity student (M.S., Penn State) with a builder’s mindset: I prototype attacks, automate defenses, and ship usable security.">
        <div className="grid md:grid-cols-3 gap-6">
          <Card>
            <h3 className="text-lg font-bold">Focus</h3>
            <p className="mt-2 text-white/70">Pentesting, DDoS simulation, router automation, digital twins for ISP-scale mitigation, secure code review.</p>
          </Card>
          <Card>
            <h3 className="text-lg font-bold">Ethos</h3>
            <p className="mt-2 text-white/70">"Break, measure, harden." Offense to discover failure modes; engineering to remove them.</p>
          </Card>
          <Card>
            <h3 className="text-lg font-bold">Currently</h3>
            <p className="mt-2 text-white/70">Building smart, agent-like defenses; teaching & mentoring; shipping labs that feel like games.</p>
          </Card>
        </div>
      </Section>

      <Section id="experience" title="Experience" subtitle="Selected roles where I learned by shipping & defending">
        <div className="grid lg:grid-cols-3 gap-6">
          <Card>
            <h3 className="font-bold text-xl">CableLabs — Network Security Intern</h3>
            <p className="text-white/60 text-sm">May–Aug 2025 • Denver, CO</p>
            <ul className="mt-3 space-y-2 text-white/80 text-sm list-disc pl-5">
              <li>Designed a modular DDoS simulation framework (L3/4, L7, amplification).</li>
              <li>Built a Digital Twin: Arbor Sightline ▸ OPNsense ▸ DIS metadata.</li>
              <li>Agent that inspects live flows & enforces time-bounded blocks.</li>
            </ul>
          </Card>
          <Card>
            <h3 className="font-bold text-xl">KPMG — Associate Consultant</h3>
            <p className="text-white/60 text-sm">Apr 2023–Aug 2024 • Mumbai</p>
            <ul className="mt-3 space-y-2 text-white/80 text-sm list-disc pl-5">
              <li>Led 10+ breach & attack simulations; 150+ vulns identified.</li>
              <li>Deployed deception honeypots integrated with SIEM; 35% faster IR.</li>
              <li>Web/API testing with Burp, Postman, Frida; OWASP aligned.</li>
            </ul>
          </Card>
          <Card>
            <h3 className="font-bold text-xl">Penn State — Instructional Assistant</h3>
            <p className="text-white/60 text-sm">Aug 2024–Present • University Park, PA</p>
            <ul className="mt-3 space-y-2 text-white/80 text-sm list-disc pl-5">
              <li>Built hands-on labs (firewalls, vuln assessment, pen testing).</li>
              <li>Guided Python/Java/PowerShell projects; secure code review.</li>
            </ul>
          </Card>
        </div>
      </Section>

      <Section id="projects" title="Projects" subtitle="Proof I like to build and break (responsibly)">
        <div className="grid md:grid-cols-2 xl:grid-cols-3 gap-6">
          <Card>
            <div className="flex items-center justify-between">
              <h3 className="font-bold text-lg">DoDDoS Tool</h3>
              <Chip>L3/4 • L7 • Amp</Chip>
            </div>
            <p className="mt-2 text-white/70">Modular traffic generator for controlled DDoS testing against defenses.</p>
            <div className="mt-4 flex flex-wrap gap-2 text-xs">
              <Chip>Python</Chip><Chip>Docker</Chip><Chip>Scapy</Chip>
            </div>
          </Card>
          <Card>
            <div className="flex items-center justify-between">
              <h3 className="font-bold text-lg">Intrusion Detection Lab</h3>
              <Chip>Gamified SOC</Chip>
            </div>
            <p className="mt-2 text-white/70">Docker-powered lab: live attacker + defender flag hunt based on alerts.</p>
            <div className="mt-4 flex flex-wrap gap-2 text-xs">
              <Chip>Snort</Chip><Chip>ELK</Chip><Chip>Python</Chip>
            </div>
            <a className="inline-block mt-4 text-cyan-300 hover:underline" href="https://github.com/trigerman/IncidentResponseLab" target="_blank">GitHub ↗</a>
          </Card>
          <Card>
            <div className="flex items-center justify-between">
              <h3 className="font-bold text-lg">Wi-Fi-Ducky</h3>
              <Chip>Hardware</Chip>
            </div>
            <p className="mt-2 text-white/70">Wi-Fi keystroke emulator using Atmega32 + ESP8266 for remote payloads.</p>
            <div className="mt-4 flex flex-wrap gap-2 text-xs">
              <Chip>Embedded</Chip><Chip>C</Chip><Chip>ESP</Chip>
            </div>
          </Card>
          <Card>
            <div className="flex items-center justify-between">
              <h3 className="font-bold text-lg">Endpoint Compliance</h3>
              <Chip>Automation</Chip>
            </div>
            <p className="mt-2 text-white/70">PowerShell to audit AD/GPO, extract configs, and harden endpoints.</p>
            <div className="mt-4 flex flex-wrap gap-2 text-xs">
              <Chip>PowerShell</Chip><Chip>AD</Chip>
            </div>
          </Card>
          <Card>
            <div className="flex items-center justify-between">
              <h3 className="font-bold text-lg">Firewall Risk Scoring</h3>
              <Chip>Risk</Chip>
            </div>
            <p className="mt-2 text-white/70">Python tool to validate firewall requests against vuln reports & rank risk.</p>
            <div className="mt-4 flex flex-wrap gap-2 text-xs">
              <Chip>Python</Chip><Chip>Security Eng</Chip>
            </div>
          </Card>
          <Card>
            <div className="flex items-center justify-between">
              <h3 className="font-bold text-lg">Cyber Bully Indicator</h3>
              <Chip>ML</Chip>
            </div>
            <p className="mt-2 text-white/70">AI/ML model to detect harmful language; published in IJSREM.</p>
            <a className="inline-block mt-4 text-cyan-300 hover:underline" href="https://ijsrem.com/download/cyber-bully-indicator/" target="_blank">Paper ↗</a>
          </Card>
        </div>
      </Section>

      <Section id="posts" title="Posts" subtitle="Recent highlights from LinkedIn">
        <div className="grid md:grid-cols-2 xl:grid-cols-3 gap-6">
          {posts.map((post) => (
            <Card key={post.title} className="p-0 overflow-hidden">
              <img
                src={post.image}
                alt={post.title}
                className="w-full h-40 object-cover rounded-t-2xl border-b border-white/10"
              />
              <div className="p-5 sm:p-6">
                <h3 className="font-bold text-lg mb-1">
                  {post.title}
                </h3>
                <p className="text-xs text-white/50 mb-2">{post.date}</p>
                <p className="text-white/70 text-sm leading-relaxed line-clamp-3">{post.excerpt}</p>
                <div className="mt-3 flex flex-wrap gap-2 text-xs">
                  {post.tags.map((tag) => (
                    <Chip key={tag}>{tag}</Chip>
                  ))}
                </div>
                <a
                  href={post.link}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="inline-block mt-4 text-cyan-300 hover:underline text-sm"
                >
                  Read on LinkedIn ↗
                </a>
              </div>
            </Card>
          ))}
        </div>
      </Section>

      <Section id="skills" title="Skills" subtitle="Tools I actually use to get things done">
        <div className="grid md:grid-cols-2 gap-6">
          <Card>
            <h3 className="font-bold mb-3">Languages</h3>
            <div className="flex flex-wrap gap-2">
              {[
                "Python","Java","TypeScript","PowerShell","Bash","SQL","C","Golang (exp)","Ruby (exploring)"
              ].map(s => <Chip key={s}>{s}</Chip>)}
            </div>
          </Card>
          <Card>
            <h3 className="font-bold mb-3">Security & Platforms</h3>
            <div className="flex flex-wrap gap-2">
              {[
                "Pentesting","Web/API Security","Threat Modeling (STRIDE)","SIEM","Bug Bounty Mgmt",
                "AWS","Azure","GCP","Linux (Kali, RHEL)","Windows"
              ].map(s => <Chip key={s}>{s}</Chip>)}
            </div>
          </Card>
          <Card className="md:col-span-2">
            <h3 className="font-bold mb-3">Tooling</h3>
            <div className="flex flex-wrap gap-2">
              {[
                "Burp Suite","Nmap","Wireshark","Nessus","Qualys","Checkmarx","Splunk","Metasploit",
                "Postman","ELK Stack","Shodan","Frida","Cymulate","Accunetix","MobSF","Fortify","AppScan"
              ].map(s => <Chip key={s}>{s}</Chip>)}
            </div>
          </Card>
        </div>
      </Section>

      <Section id="achievements" title="Achievements" subtitle="Impact and recognition">
        <div className="grid md:grid-cols-3 gap-6">
          <Card>
            <h3 className="font-bold">Hall of Fame</h3>
            <p className="mt-2 text-white/70">SAP, TripAdvisor, MasterCard, HealthifyMe, Máxima MC, Kenna Security, itslearning.com, APNIC.</p>
          </Card>
          <Card>
            <h3 className="font-bold">CyberForce (DOE)</h3>
            <p className="mt-2 text-white/70">24th/100 nationally — pentest, IR, and mitigation challenges.</p>
          </Card>
          <Card>
            <h3 className="font-bold">CCDC</h3>
            <p className="mt-2 text-white/70">2nd/17 in regional qualifier — kept services alive under fire.</p>
          </Card>
        </div>
      </Section>

      <Section id="resume" title="Resume">
        <Card>
          <p className="text-white/80">Prefer the one-page view? Grab the latest resume and connect on LinkedIn.</p>
          <div className="mt-4 flex flex-wrap gap-3">
            <a className="rounded-xl px-4 py-2 bg-white/10 border border-white/15 hover:bg-white/15" href="/DhrupadJoshiCV.pdf" download>Download PDF</a>
            <a className="rounded-xl px-4 py-2 bg-cyan-500/20 border border-cyan-400/40 hover:bg-cyan-500/30" href="https://www.linkedin.com/in/dhrupad-joshi/" target="_blank">LinkedIn Profile ↗</a>
          </div>
        </Card>
      </Section>

      <Section id="contact" title="Contact" subtitle="Looking for teams who like to break, learn, and build fast">
        <Card>
          <form className="grid gap-4">
            <div className="grid sm:grid-cols-2 gap-4">
              <input placeholder="Name" className="rounded-xl bg-white/5 border border-white/10 px-4 py-2 outline-none focus:border-cyan-400/50" />
              <input placeholder="Email" className="rounded-xl bg-white/5 border border-white/10 px-4 py-2 outline-none focus:border-cyan-400/50" />
            </div>
            <textarea placeholder="Your message" rows={4} className="rounded-xl bg-white/5 border border-white/10 px-4 py-2 outline-none focus:border-cyan-400/50" />
            <button type="button" className="justify-self-start rounded-xl px-4 py-2 bg-gradient-to-r from-cyan-500/70 to-fuchsia-500/70 hover:from-cyan-500 hover:to-fuchsia-500 border border-white/10 shadow-lg">
              Send (disabled in demo)
            </button>
          </form>
        </Card>
      </Section>

      <footer className="py-10 text-center text-white/50 text-sm">
        Built with ♥ — Dark, fast, and a bit dangerous.
      </footer>
    </div>
  );
}
